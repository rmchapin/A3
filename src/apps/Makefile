include ../common.mk

COMMON_FLAGS = $(CFLAGS_VX_GTK) \
	$(CFLAGS_IMAGESOURCE) \
	$(CFLAGS_MATH) \
	$(CFLAGS_COMMON) \
	$(CFLAGS_LCMTYPES) \
	$(CFLAGS_A3) \
	$(CFLAGS_GSL) \
	$(CFLAGS_EIGEN) \
	$(CFLAGS_USB) \
	$(CFLAGS_FREENECT)

CFLAGS = $(COMMON_FLAGS) \
	$(CFLAGS_STD)

CXXFLAGS = $(COMMON_FLAGS) \
	$(CXXFLAGS_STD)

LDFLAGS = $(LDFLAGS_STD) \
	$(LDFLAGS_VX_GTK) \
	$(LDFLAGS_IMAGESOURCE) \
	$(LDFLAGS_MATH) \
	$(LDFLAGS_COMMON) \
	$(LDFLAGS_LCMTYPES) \
	$(LDFLAGS_MAPPING) \
	$(LDFLAGS_A3) \
	$(LDFLAGS_GSL) \
	$(LDFLAGS_EIGEN) \
	$(LDFLAGS_USB) \
	$(LDFLAGS_FREENECT)

LIBDEPS = $(call libdeps, $(LDFLAGS))

LIB_EECS467 = $(LIB_PATH)/libeecs467.a
LIBEECS467_OBJS = eecs467_util.o

BIN_EECS467_GUI_EXAMPLE = $(BIN_PATH)/eecs467_gui_example
BIN_EECS467_REXARM_EXAMPLE = $(BIN_PATH)/eecs467_rexarm_example
BIN_EECS467_MAIN = $(BIN_PATH)/eecs467_main
BIN_EECS467_CALIBRATION = $(BIN_PATH)/eecs467_calibration
BIN_EECS467_ARM = $(BIN_PATH)/eecs467_arm_test
BIN_EECS467_TEST = $(BIN_PATH)/eecs467_test

ALL = $(LIB_EECS467) $(BIN_EECS467_GUI_EXAMPLE) \
	$(BIN_EECS467_REXARM_EXAMPLE) \
	$(BIN_EECS467_CALIBRATION) \
	$(BIN_EECS467_MAIN) \
	$(BIN_EECS467_ARM) \
	$(BIN_EECS467_TEST)

all: $(ALL)

test: $(BIN_EECS467_TEST)

$(LIB_EECS467): $(LIBEECS467_OBJS) $(LIBDEPS)
	@echo "\t$@"
	@ar rc $@ $(LIBEECS467_OBJS)

$(BIN_EECS467_GUI_EXAMPLE): gui_example.o $(LIB_EECS467) $(LIBDEPS)
	@echo "\t$@"
	@$(CC) -o $@ $^ $(LDFLAGS) $(LIB_EECS467)

$(BIN_EECS467_REXARM_EXAMPLE): rexarm_example.o $(LIBDEPS)
	@echo "\t$@"
	@$(CC) -o $@ $^ $(LDFLAGS)
	
$(BIN_EECS467_MAIN): eecs467_main.o VxHandler.o eecs467_util.o $(LIBDEPS)
	@echo "\t$@"
	@$(CXX) -o $@ $^ $(LDFLAGS)

$(BIN_EECS467_CALIBRATION): eecs467_calibration.o $(LIB_EECS467) $(LIBDEPS)
	@echo "\t$@"
	@$(CXX) -o $@ $^ $(LDFLAGS)

$(BIN_EECS467_ARM): eecs467_arm_test.o $(LIBDEPS)
	@echo "\t$@"
	@$(CXX) -o $@ $^ $(LDFLAGS)

$(BIN_EECS467_TEST): eecs467_test.o $(LIBDEPS)
	@echo "\t$@"
	@$(CXX) -o $@ $^ $(LDFLAGS)	

clean:
	@rm -f *.o *~ *.a
	@rm -f $(ALL)
